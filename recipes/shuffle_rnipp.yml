recipes:
  shuffle_rnipp:
    input: rnipp_fwf
    output: shuffle_rnipp
    steps:
      - map:
          DCD_NOM: DCD_NOM_PRENOMS
          DCD_PRENOMS: DCD_NOM_PRENOMS
      - replace:
          select: DCD_NOM$
          regex:
            - ^(.*)\*.*/$: '\1'     
      - replace:
          select: DCD_PRENOMS$
          regex:
            - ^.*\*(.*)/$: '\1'
      - map:
          DCD_LIEU_NAISSANCE:
            - DCD_CODE_INSEE_NAISSANCE
            - DCD_COMMUNE_NAISSANCE
            - DCD_PAYS_NAISSANCE
          DCD_PRENOMS_SEXE:
            - DCD_PRENOMS
            - DCD_SEXE
      - delete:
          select: (DCD_NOM_PRENOMS|DCD_(PAYS|COMMUNE|CODE_INSEE)_NAISSANCE|DCD_SEXE|DCD_PRENOMS)$
      - shuffle:
      - eval:
          - DCD_PRENOMS: DCD_PRENOMS_SEXE[0]
          - DCD_SEXE: DCD_PRENOMS_SEXE[1]
          - DCD_NOM_PRENOMS: DCD_NOM+"*"+DCD_PRENOMS+"/"
          - DCD_CODE_INSEE_NAISSANCE: DCD_LIEU_NAISSANCE[0]
          - DCD_COMMUNE_NAISSANCE: DCD_LIEU_NAISSANCE[1] 
          - DCD_PAYS_NAISSANCE: DCD_LIEU_NAISSANCE[2]
      - delete:
          select: DCD_(NOM|PRENOMS|PRENOMS_SEXE|LIEU_NAISSANCE)$ 
      - keep:
          select: .*
          where: DCD_DATE_DECES > DCD_DATE_NAISSANCE
      